@{
    ViewData["Title"] = "Home Page";
}
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" />

    <!--Can we move these?-->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript" src="~/lib/bootstrap/dist/js/bootstrap.js"></script>

    <script type="text/javascript" src="~/lib/bootstrap/dist/js/bootstrap.bundle.js"></script>
    <script type="text/javascript" src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <script type="text/javascript" src="~/lib/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="~/lib/bootstrap/dist/js/bootstrap.min.js"></script>


</head>
<body>

  

    <div class="row">

        <div class="container">



            <div class="col-6">



                <div class="container">
                    <div class="card-header">
                        newest batches (qty 50): <span id="isMaxedOut" class="red"></span>
                    </div>
                    <ul class="list-group list-unstyled flex-fill pre-scrollable">

                        @{
                            int a = 0;
                            // 50 is amount of batches in progress (max).
                            for (int x = 0; x < 50; x++)
                            {
                                BatchModel batch = new BatchModel();

                                if (x < a)
                                {
                                    foreach (BatchModel inv in ViewBag.NewestBatches)
                                    {
                                        batch = inv;
                                        a++;
                                    }
                                }
                                <li class="list-group-item">
                                    <div>
                                        <div class="form-check form-switch float-left">
                                            <input class="form-check-input" type="checkbox" id="flexSwitchCompleted">
                                        </div>
                                    </div>

                                    <div class="form-text float-left" id="idOf_@x">@batch.ID</div>
                                    <div id="nameOf_@x">@batch.NameOf</div>


                                    <div>
                                        <span class="badge bg-primary rounded-pill float-right" id="batchTotal_@x">@batch.Total</span>
                                    </div>

                                    <div id="started_@x">@batch.Started</div>

                                </li>



                            }
                        }
                    </ul>





                </div>


                @**Can we make this dynamic from Db?*@
                <select id="nameOfDoughnutBatch"class="form-select" aria-label="Default select example">
                    <option value="1">Classic Glazed</option>
                    <option value="2">Strawberry PopTart</option>
                    <option value="3">Chocolatte</option>
                    <option value="4">Capn Crunched</option>
                    <option value="5">M&M 'manem</option>
                    <option value="6">Shred Tha Gnar</option>
                    <option value="7">Sugar High</option>
                </select>
                <select id="quantityOfBatch"class="form-select" aria-label="Default select example">
                    <option value="1">6</option>
                    <option value="2">12</option>
                    <option value="3">24</option>
                    <option value="4">48</option>
                </select>



                <div class="row justify-content-sm-center">
                    <button id="createBatch" class="btn float-right">create batch</button>
                </div>




            </div>



            <div class="col-2">



                    <div class="container">
                        <div class="card-header">
                            totals:
                        </div>
                        <table class="table table-sm table-dark table-hover table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th scope="col">Name</th>
                                    <th scope="col">Total</th>
                                </tr>
                            </thead>

                            <tbody>

                                @{
                                    int y = 0;
                                    // 8 is amount of dif types of doughnuts in inventory.
                                    for (int x = 0; x < 8; x++)
                                    {
                                        InventoryOnHandModelByType type = new InventoryOnHandModelByType();

                                        if (x < y)
                                        {
                                            foreach (InventoryOnHandModelByType inv in ViewBag.InvTotalsByType)
                                            {
                                                type = inv;
                                                y++;
                                            }
                                        }
                                        <tr>
                                            <td id="nameOfType_@x">@type.NameOf</td>
                                            <td id="batchTotalType_@x">@type.Total</td>
                                        </tr>
                                    }
                                }


                            </tbody>
                        </table>
                    </div>



                </div>



                <div class="col-4">



                    <div class="container">
                        <div class="card-header">
                            expires next:
                        </div>
                        <table class="table table-sm table-dark table-hover table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th scope="col">Batch ID</th>
                                    <th scope="col">Name</th>
                                    <th scope="col">Total</th>
                                    <th scope="col">Expires</th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    int b = 0;
                                    // 8 is amount of dif types of doughnuts in inventory.
                                    for (int x = 0; x < 8; x++)
                                    {
                                        InventoryOnHandModel batch = new InventoryOnHandModel();

                                        if (x < b)
                                        {
                                            foreach (InventoryOnHandModel inv in ViewBag.ExpiresNext)
                                            {
                                                batch = inv;
                                                b++;
                                            }
                                        }
                                        <tr>
                                            <td id="idOfBatch_Exp_@x">@batch.BatchId</td>
                                            <td id="nameOf_Exp_@x">@batch.NameOf</td>
                                            <td id="totalOf_Exp_@x">@batch.Total</td>
                                            <td id="expOf_Exp_@x">@batch.Expiration</td>
                                        </tr>

                                    }
                                }
                            </tbody>
                        </table>
                    </div>



                </div>




        </div>






    </div>




    



    <div class="row justify-content-sm-center">
        <button id="getBatches" class="btn float-right">get batches</button>
    </div>

    <script type="text/javascript">
         $(function() {
                        $("#createBatch").click(function () {

                            var nameOf = document.getElementById("nameOfDoughnutBatch").innerHTML;
                            var total = document.getElementById("quantityOfBatch").innerHTML;

                            var props = [
                                { "Name": "firstName", "Value": "firstValue" },
                                { "Name": "secondName", "Value": "secondValue" }
                            ];

                            $.ajax({
                                url: '/Home/CreateBatchRecord',
                                type: 'POST',
                                dataType: 'json',
                                contentType: 'application/json',
                                data: JSON.stringify(props)
                                
                            });
                        })
                    });
    </script>

    <script type="text/javascript">
        $(function () {
            $("#getBatches").click(function () {

                $.ajax({
                    url: '/Home/GetAllBatchesFromS_Proc',
                    type: 'GET',
                    dataType: 'json',
                    success: function (data) {
                        if (data.length > 0) {

                            var parsedData = JSON.parse(data);

                            if (parsedData.length > 50) {

                                document.getElementById("isMaxedOut").innerHTML = "more than 50 batches!";

                            }

                            for (let i = 0; i < data.length; i++) {
                                document.getElementById("idOf_" + i).innerHTML = parsedData[i].ID;
                                document.getElementById("nameOf_" + i).innerHTML = parsedData[i].NameOf;
                                document.getElementById("batchTotal_" + i).innerHTML = parsedData[i].Total;
                                document.getElementById("started_" + i).innerHTML = parsedData[i].Started;
                            }
                        }
                        else {
                            alert("FAILED");
                        }
                    }
                });

                // Update expires next.
                $.ajax({
                    url: '/Home/GetExpiresNext',
                    type: 'GET',
                    dataType: 'json',
                    success: function (data) {
                        if (data.length > 0) {

                            var parsedData = JSON.parse(data);

                            for (let i = 0; i < data.length; i++) {
                                document.getElementById("idOfBatch_Exp_" + i).innerHTML = parsedData[i].BatchId;
                                document.getElementById("nameOf_Exp_" + i).innerHTML = parsedData[i].NameOf;
                                document.getElementById("totalOf_Exp_" + i).innerHTML = parsedData[i].Total;
                                document.getElementById("expOf_Exp_" + i).innerHTML = parsedData[i].Expiration;
                            }
                        }
                        else {
                            alert("FAILED");
                        }
                    }
                });

                // Update totals by type.
                $.ajax({
                    url: '/Home/GetInventoryOnHandAllByType',
                    type: 'GET',
                    dataType: 'json',
                    success: function (data) {
                        if (data.length > 0) {

                            var parsedData = JSON.parse(data);

                            for (let i = 0; i < data.length; i++) {
                                document.getElementById("nameOfType_" + i).innerHTML = parsedData[i].NameOf;
                                document.getElementById("batchTotalType_" + i).innerHTML = parsedData[i].Total;
                            }
                        }
                        else {
                            alert("FAILED");
                        }
                    }
                });
            })
        });
    </script>
</body>
</html>

